'use strict';

const Hoek = require('hoek');

const DEFAULTS = {
    connectionString: undefined,
    attach: 'onPreHandler',
    detach: 'tail',
};

exports.register = function (server, options, next) {
    const config = Hoek.applyToDefaults(DEFAULTS, options);
    server.expose('knex', config.knex);

    server.ext(config.attach, (request, reply) => {
        request.knex = config.knex;
        reply.continue();
    });

    next();
};

exports.register.attributes = {
    name: 'HapiKnex',
};